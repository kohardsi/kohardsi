const firebaseConfig={apiKey:"AIzaSyDE8YQywhPg1Jstd5CHmO6mUCUibx9cJ6Q",authDomain:"tejyul22.firebaseapp.com",databaseURL:"https://tejyul22-default-rtdb.firebaseio.com",projectId:"tejyul22",storageBucket:"tejyul22.appspot.com",messagingSenderId:"169996071627",appId:"1:169996071627:web:a37b578fdcf39e8c39214e"};firebase.initializeApp(firebaseConfig);const database=firebase.database();function getURLParameter(name){const urlParams=new URLSearchParams(window.location.search);return urlParams.get(name)}const guestName=getURLParameter("to")||"Anonymous";document.getElementById("name").value=guestName;function showAlert(message,type){const alertPlaceholder=document.getElementById("alertPlaceholder");const wrapper=document.createElement("div");wrapper.innerHTML=`\n    <div class="alert alert-${type} alert-dismissible fade show" role="alert">\n      ${message}\n      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n    </div>\n  `;alertPlaceholder.append(wrapper);setTimeout((()=>{wrapper.remove()}),3e3)}document.getElementById("attendanceForm").addEventListener("submit",(function(e){e.preventDefault();const name=document.getElementById("name").value;const attendance=document.getElementById("attendance").value;const message=document.getElementById("message").value;if(!attendance){showAlert("Silakan pilih konfirmasi kehadiran.","danger");return}if(message.length<5){showAlert("Pesan minimal harus 5 karakter.","warning");return}let finalMessage="";if(attendance&&message){finalMessage=`${name}, ${attendance}\n${message}`}else if(attendance){finalMessage=`${name}, ${attendance}`}else if(message){finalMessage=`${name}\n${message}`}if(finalMessage){const discussionRef=database.ref("discussions");discussionRef.push({message:finalMessage}).then((()=>{const nameField=document.getElementById("name").value;document.getElementById("attendanceForm").reset();document.getElementById("name").value=nameField;showAlert("Pesan berhasil dikirim!","success");displayMessage(name,attendance,message)})).catch((error=>{showAlert("Error: "+error.message,"danger")}))}}));function displayMessage(name,attendance,message){const messageList=document.getElementById("messageList");const li=document.createElement("li");let icon="";if(attendance==="Hadir"){icon=`<i class="fa fa-check-circle" style="color:green;"></i>`}else if(attendance==="Tidak Hadir"){icon=`<i class="fa fa-times-circle" style="color:red;"></i>`}let content=`<span class="name">${name} ${icon}</span>`;if(attendance){content+=`<div class="attendance">${attendance}</div>`}if(message){content+=`<div class="message">${message}</div>`}li.innerHTML=content;messageList.appendChild(li)}function displayMessage(name,attendance,message){const messageList=document.getElementById("messageList");const li=document.createElement("li");li.classList.add("comment","even","thread-even","depth-1","cui-item-comment");let icon="";if(attendance==="Hadir"){icon=`<i class="fa fa-check-circle" style="color:green;"></i>`}else if(attendance==="Tidak Hadir"){icon=`<i class="fa fa-times-circle" style="color:red;"></i>`}let content="";if(attendance&&message){content=`<div class="cui-comment cui-clearfix">\n  <div class="cui-comment-content"><div class="cui-comment-info">\n    <a href='javascript:void(0)' class="cui-commenter-name">${name}</a>\n    <span class="cui-post-author-mark">${icon}</span>\n  </div>\n  <div class="cui-comment-text">\n    <p>${message}</p>\n  </div></div>\n</div>\n`}else if(attendance){content=`<div class="cui-comment cui-clearfix">\n  <div class="cui-comment-content"><div class="cui-comment-info">\n    <a href='javascript:void(0)' class="cui-commenter-name">${name}</a>\n    <span class="cui-post-author-mark">${icon}</span>\n  </div>\n  <div class="cui-comment-text">\n    <p>${attendance}</p>\n  </div></div>\n</div>\n`}else if(message){content=`<div class="cui-comment cui-clearfix">\n  <div class="cui-comment-content"><div class="cui-comment-info">\n    <a href='javascript:void(0)' class="cui-commenter-name">${name}</a>\n    <span class="cui-post-author-mark">${icon}</span>\n  </div>\n  <div class="cui-comment-text">\n    <p>${message}</p>\n  </div></div>\n</div>\n`}li.innerHTML=content;messageList.appendChild(li)}let hadirCount=0;let tidakHadirCount=0;let totalComments=0;const discussionRef=database.ref("discussions");discussionRef.on("child_added",(function(data){const fullMessage=data.val().message;let name="";let attendance="";let message="";if(fullMessage.includes(",")){[name,attendance]=fullMessage.split(", ");if(attendance.includes("\n")){[attendance,message]=attendance.split("\n")}}else{[name,message]=fullMessage.split("\n")}if(attendance==="Hadir"){hadirCount++}else if(attendance==="Tidak Hadir"){tidakHadirCount++}totalComments++;document.getElementById("hadirCount").innerText=hadirCount;document.getElementById("tidakHadirCount").innerText=tidakHadirCount;document.querySelector(".comments-count").innerText=`${totalComments} Comments`;displayMessage(name,attendance,message)}));